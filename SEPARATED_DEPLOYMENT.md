# Employee Leave Management System - Separated Architecture Deployment

## ğŸ—ï¸ Architecture Overview

This guide shows how to deploy the ELMS with separated backend (Render) and frontend (Vercel):

- **Backend API**: Flask REST API on Render
- **Frontend**: Next.js application on Vercel

## ğŸ“‹ Prerequisites

1. GitHub account with your repository
2. Render account (for backend)
3. Vercel account (for frontend)

## ğŸš€ Backend Deployment (Render)

### Step 1: Prepare Backend Files

The following files have been created for the API:
- `api.py` - Pure Flask REST API
- `requirements-api.txt` - API dependencies
- `wsgi_api.py` - WSGI entry point
- `Dockerfile.api` - Docker configuration
- `render-api.yaml` - Render configuration

### Step 2: Deploy to Render

1. **Push to GitHub** (if not already done):
   ```bash
   git add .
   git commit -m "Add separated API backend"
   git push origin main
   ```

2. **Create Render Service**:
   - Go to https://render.com/dashboard
   - Click "New +" â†’ "Web Service"
   - Connect your GitHub repository
   - Configure:
     - **Name**: `elms-api`
     - **Environment**: `Docker`
     - **Dockerfile Path**: `./Dockerfile.api`
     - **Branch**: `main`

3. **Environment Variables**:
   ```
   FLASK_ENV=production
   SECRET_KEY=<auto-generated>
   DATABASE_URL=sqlite:///instance/elms_api.db
   ```

4. **Deploy**: Render will build and deploy automatically

### Step 3: Get Backend URL

After deployment, your API will be available at:
```
https://elms-api-[random].onrender.com
```

## ğŸŒ Frontend Deployment (Vercel)

### Option 1: Quick Deploy with Vercel CLI

1. **Install Vercel CLI**:
   ```bash
   npm i -g vercel
   ```

2. **Navigate to frontend folder**:
   ```bash
   cd frontend
   npm install
   ```

3. **Deploy**:
   ```bash
   vercel --prod
   ```

4. **Set Environment Variables**:
   In Vercel dashboard, add:
   ```
   API_BASE_URL=https://your-render-api-url.onrender.com
   ```

### Option 2: Deploy via Vercel Dashboard

1. **Go to Vercel Dashboard**: https://vercel.com/dashboard
2. **Import Project**: Connect your GitHub repository
3. **Configure**:
   - **Framework**: Next.js
   - **Root Directory**: `frontend`
   - **Build Command**: `npm run build`
   - **Output Directory**: `.next`

4. **Environment Variables**:
   ```
   API_BASE_URL=https://your-render-api-url.onrender.com
   ```

## ğŸ”— API Endpoints

Your Flask API provides these endpoints:

### Authentication
- `POST /api/auth/register` - User registration
- `POST /api/auth/login` - User login
- `GET /api/auth/profile` - Get user profile

### Leave Management
- `GET /api/leaves` - Get leave requests
- `POST /api/leaves` - Create leave request
- `PUT /api/leaves/{id}` - Approve/reject leave

### Admin (Admin only)
- `GET /api/admin/users` - Get all users
- `GET /api/admin/stats` - Get statistics
- `GET /api/admin/audit-logs` - Get audit logs

### Health Check
- `GET /api/health` - API health status

## ğŸ§ª Testing the API

Test your deployed API:

```bash
# Health check
curl https://your-api-url.onrender.com/api/health

# Register user
curl -X POST https://your-api-url.onrender.com/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "email": "test@example.com",
    "password": "password123",
    "role": "employee",
    "team": "Engineering"
  }'

# Login
curl -X POST https://your-api-url.onrender.com/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123"
  }'
```

## ğŸ” Default Login Credentials

The API creates these default users:

| Role | Username | Password |
|------|----------|----------|
| Admin | `admin` | `admin123` |
| Manager | `manager` | `manager123` |
| Employee | `employee` | `employee123` |

## ğŸš€ Quick Start Commands

### Deploy Backend Only (Current Solution)

```bash
# Navigate to project
cd "c:\Desktop\python works\employee-Leave-MS"

# Add API files
git add api.py requirements-api.txt wsgi_api.py Dockerfile.api render-api.yaml

# Commit and push
git commit -m "Add separated API backend for Render deployment"
git push origin main
```

Then create a new web service on Render using `Dockerfile.api`.

### Deploy Frontend (After Backend is Ready)

```bash
# Navigate to frontend
cd frontend

# Install dependencies
npm install

# Build and deploy
npm run build
vercel --prod
```

## ğŸ”§ Configuration Notes

1. **CORS**: The API is configured to accept requests from any origin. In production, update CORS settings in `api.py` to only allow your Vercel domain.

2. **Database**: Currently using SQLite for simplicity. For production, consider PostgreSQL.

3. **Authentication**: Uses JWT tokens with 24-hour expiry.

4. **File Structure**:
   ```
   project/
   â”œâ”€â”€ api.py              # Flask API
   â”œâ”€â”€ requirements-api.txt # API dependencies
   â”œâ”€â”€ wsgi_api.py         # WSGI entry point
   â”œâ”€â”€ Dockerfile.api      # API Docker config
   â”œâ”€â”€ render-api.yaml     # Render config
   â””â”€â”€ frontend/           # Next.js frontend
       â”œâ”€â”€ package.json
       â”œâ”€â”€ next.config.js
       â””â”€â”€ src/
   ```

## ğŸ¯ Next Steps

1. **Deploy Backend**: Use the API files to deploy on Render
2. **Build Frontend**: Complete the Next.js frontend development
3. **Deploy Frontend**: Deploy the frontend on Vercel
4. **Connect**: Configure frontend to use the backend API URL
5. **Test**: Verify all functionality works end-to-end

Would you like me to help you deploy the backend API first, or shall we focus on completing the frontend development?
